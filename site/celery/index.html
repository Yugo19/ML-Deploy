<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>celery config and tasks - My Docs</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <link href="../assets/_mkdocstrings.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">My Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Welcom</a>
                            </li>
                            <li class="navitem">
                                <a href="../install.md" class="nav-link">Install and run</a>
                            </li>
                            <li class="navitem">
                                <a href="../system-arch/" class="nav-link">System Arch</a>
                            </li>
                            <li class="navitem">
                                <a href="../cnn/" class="nav-link">cnn service</a>
                            </li>
                            <li class="navitem">
                                <a href="../llm/" class="nav-link">llm service</a>
                            </li>
                            <li class="navitem active">
                                <a href="./" class="nav-link">celery config and tasks</a>
                            </li>
                            <li class="navitem">
                                <a href="../models/" class="nav-link">Pydantic model</a>
                            </li>
                            <li class="navitem">
                                <a href="../contrubition-guiline.md" class="nav-link">contrubition guideline</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../llm/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../models/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#services.celery.celery_config" class="nav-link">celery_config</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#services.celery.celery_config.make_celery" class="nav-link">make_celery</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#services.celery.celery_task" class="nav-link">celery_task</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#services.celery.celery_task.fetch_contextual_information" class="nav-link">fetch_contextual_information</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#services.celery.celery_task.perform_prediction" class="nav-link">perform_prediction</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<div class="doc doc-object doc-module">



<a id="services.celery.celery_config"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="services.celery.celery_config.make_celery" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">make_celery</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Create and configure a Celery application instance with Redis as the message broker and backend.</p>
<p>This function sets up Celery with Redis, specifying the same URI for both the backend and broker. 
This configuration is necessary for task queueing and result storage for distributed task processing.</p>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
<td><code>Celery</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A Celery application instance configured to use Redis for queuing tasks and storing results.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>app/services/celery/celery_config.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_celery</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create and configure a Celery application instance with Redis as the message broker and backend.</span>

<span class="sd">    This function sets up Celery with Redis, specifying the same URI for both the backend and broker. </span>
<span class="sd">    This configuration is necessary for task queueing and result storage for distributed task processing.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Celery: A Celery application instance configured to use Redis for queuing tasks and storing results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize Celery</span>
    <span class="n">celery</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span>
        <span class="s1">&#39;worker&#39;</span><span class="p">,</span>  <span class="c1"># Name of the worker</span>
        <span class="n">backend</span><span class="o">=</span><span class="s1">&#39;redis://yugo:Maoene@redis:6379/0&#39;</span><span class="p">,</span>  <span class="c1"># URI for Redis backend (Results backend)</span>
        <span class="n">broker</span><span class="o">=</span><span class="s1">&#39;redis://yugo:Maoene@redis:6379/0&#39;</span>    <span class="c1"># URI for Redis broker (Queue)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">celery</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<a id="services.celery.celery_task"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="services.celery.celery_task.fetch_contextual_information" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">fetch_contextual_information</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">sensitive_structures</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>A Celery task that fetches contextual information based on a given prediction and the sensitivity of certain structures.
This function uses language models to generate text responses that provide context, impact assessment, and potential solutions
for the predicted event, specifically tailored to an African context and local community management.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>prediction</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The predicted incident or object from the image.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>sensitive_structures</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of structures or elements identified as sensitive and relevant to the incident.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
<td><code>tuple</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A tuple containing contextual information about the incident, its impact on the sensitive structures, and suggested solutions.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>app/services/celery/celery_task.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@celery_app</span><span class="o">.</span><span class="n">task</span>
<span class="k">def</span> <span class="nf">fetch_contextual_information</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">sensitive_structures</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Celery task that fetches contextual information based on a given prediction and the sensitivity of certain structures.</span>
<span class="sd">    This function uses language models to generate text responses that provide context, impact assessment, and potential solutions</span>
<span class="sd">    for the predicted event, specifically tailored to an African context and local community management.</span>

<span class="sd">    Args:</span>
<span class="sd">        prediction (str): The predicted incident or object from the image.</span>
<span class="sd">        sensitive_structures (list): A list of structures or elements identified as sensitive and relevant to the incident.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing contextual information about the incident, its impact on the sensitive structures, and suggested solutions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">get_context</span> <span class="o">=</span> <span class="n">get_response</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;What is a </span><span class="si">{</span><span class="n">prediction</span><span class="si">}</span><span class="s2"> in an African zone?&quot;</span><span class="p">)</span>
    <span class="n">impact</span> <span class="o">=</span> <span class="n">get_response</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;What is the impact of </span><span class="si">{</span><span class="n">prediction</span><span class="si">}</span><span class="s2"> on </span><span class="si">{</span><span class="n">sensitive_structures</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">piste_solution</span> <span class="o">=</span> <span class="n">get_response</span><span class="p">(</span><span class="s2">&quot;What are the possible solutions for the previous case? Assuming it&#39;s managed by a local community.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">get_context</span><span class="p">,</span> <span class="n">impact</span><span class="p">,</span> <span class="n">piste_solution</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="services.celery.celery_task.perform_prediction" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">perform_prediction</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>A Celery task that performs image prediction using a convolutional neural network.
This function processes an image to predict its content and calculate the probabilities of different classifications.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>image</code></td>
          <td>
                <code>bytes</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The image data in bytes format, ready to be processed by the prediction model.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
<td><code>tuple</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A tuple containing the predicted classification and a list of probabilities associated with each class.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>app/services/celery/celery_task.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@celery_app</span><span class="o">.</span><span class="n">task</span>
<span class="k">def</span> <span class="nf">perform_prediction</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Celery task that performs image prediction using a convolutional neural network.</span>
<span class="sd">    This function processes an image to predict its content and calculate the probabilities of different classifications.</span>

<span class="sd">    Args:</span>
<span class="sd">        image (bytes): The image data in bytes format, ready to be processed by the prediction model.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing the predicted classification and a list of probabilities associated with each class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">prediction</span><span class="p">,</span> <span class="n">probabilities</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">prediction</span><span class="p">,</span> <span class="n">probabilities</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/jquery-3.6.0.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
